<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>March Madness Simulator</title>
</head>
<body>
    <h1>Welcome to the March Madness Simulator</h1>
    <p>Enter your preferences below to simulate a bracket:</p>

    </form>
        <!-- Year Input (enter/arrows) -->
        <label for="year">Year:</label>
        <input type="number" id="year" name="year" min="2008" max="2024" value="{{ max_year }}" required onchange="updateTeams()"><br><br>

        <!-- Picked Winner Input (dropdown, updated dynamically basied on year) -->
        <label for="picked_winner">Picked Winner:</label>
        <select id="picked_winner" name="picked_winner">
            <option value="None" selected>None</option> <!-- Default -->
        </select><br><br>

        <script>
            async function updateTeams() {
                const year = document.getElementById('year').value;
                const teamDropdown = document.getElementById('picked_winner');

                // get teams for the selected year
                const response = await fetch(`/get_teams/${year}`);
                const teams = await response.json();

                // clear current dropdown options
                teamDropdown.innerHTML = "";

                // fill in the new options
                teams.forEach(team => {
                    const option = document.createElement("option");
                    option.value = team;
                    option.textContent = team;
                    teamDropdown.appendChild(option);
                });
            }

            // load teams when the page first loads (for the default year)
            window.onload = updateTeams;
        </script>

        <!-- Playstyle Input (dropdown) -->
        <label for="playstyle">Playstyle:</label>
        <select id="playstyle" name="playstyle">
            <option value="Balanced">Balanced</option>
            <option value="I Love Offense">I Love Offense</option>
            <option value="Defense Wins Championships">Defense Wins Championships</option>
        </select><br><br>

        <!-- Boldness Input (dropdown) -->
        <label for="boldness">Boldness:</label>
        <select id="boldness" name="boldness">
            <option value="Go Big or Go Home">Go Big or Go Home</option>
            <option value="Bold">Bold</option>
            <option value="Normal" selected>Normal</option>
            <option value="Safe">Safe</option>
            <option value="So Safe">So Safe</option>
        </select><br><br>

        <!-- Submit Button -->
        <button type="button" onclick="runSimulation()">Simulate</button>
    </form>

    <!-- Placeholder for results -->
    <div id="results"></div>

    <script>

        console.log("JavaScript is running!");

        // JavaScript to send inputs to the backend 
        async function runSimulation() {
            // retrieve user inputs
            const year = document.getElementById('year').value;
            const picked_winner = document.getElementById('picked_winner').value;
            const playstyle = document.getElementById('playstyle').value;
            const boldness = document.getElementById('boldness').value;

            console.log("User Inputs:", { year, picked_winner, playstyle, boldness });
            
            // send inputs to the backend
            const response = await fetch('/simulate', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({
                    year: parseInt(year, 10),
                    picked_winner: picked_winner,
                    playstyle: playstyle,
                    boldness: boldness
                })
            });

            console.log("Response Status:", response.status);

            // get json response
            const result = await response.json();

            console.log("Response Data:", result);

            // display the results
            const resultsDiv = document.getElementById('results');
            if (result.status === 'success') {
                resultsDiv.innerHTML = `<h2>Simulation Results</h2><pre>${JSON.stringify(result.results, null, 2)}</pre>`;
            } else {
                resultsDiv.innerHTML = `<h2>Error</h2><p>${result.message}</p>`;
            }
        }
    </script>
</body>
</html>
